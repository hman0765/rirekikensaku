<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>履歴検索</title>
  <link href="favicon.ico" rel="icon">
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #results { margin-top: 20px; }
    .result { padding: 5px; border-bottom: 1px solid #ccc; }
    .file { color: #888; font-size: 0.9em; }
  </style>
</head>
<body>
  <h2>過去の履歴一括検索</h2>
  <p>テスト運営中</p>
  <input type="text" id="query" placeholder="曲名 or アーティスト">
  <button onclick="search()">検索</button>
  <div id="count"></div>
  <div id="pagination"></div>
  <div id="results"></div>
 <script>
  const jsonFiles = [
"data/201012.json",
"data/201102.json",
"data/201104.json",
"data/201108.json",
"data/201109.json",
"data/201112.json",
"data/201204.json",
"data/201208.json",
"data/201212.json",
"data/201304.json",
"data/201308.json",
"data/201312.json",
"data/201404.json",
"data/201408.json",
"data/201412.json",
"data/201504.json",
"data/201508.json",
"data/201512.json",
"data/201604.json",
"data/201608.json",
"data/201612.json",
"data/201704.json",
"data/201708.json",
"data/201712.json",
"data/201804.json",
"data/201808.json",
"data/201812.json",
"data/201904.json",
"data/201908.json",
"data/201912.json",
"data/202004.json",
"data/202008.json",
"data/202012.json",
"data/202101.json",
"data/202104.json",
"data/202108.json",
"data/202112.json",
"data/202204.json",
"data/202208.json",
"data/202209.json",
"data/202212.json",
"data/202304.json",
"data/202308.json",
"data/202312.json",
"data/202404.json",
"data/202408.json",
"data/202412.json",
"data/202501.json",
"data/202504.json",
"data/202508.json",
  ]; 
   let allData = [];
  let matches = [];
  let currentPage = 1;
  const pageSize = 100;

  async function loadData() {
    for (let file of jsonFiles) {
      try {
        const res = await fetch(file);
        const data = await res.json();
        allData = allData.concat(data);
      } catch (e) {
        console.error("Loaderror:", file, e);
      }
    }
  }

  async function search() {
  const query = document.getElementById("query").value.trim();
  matches = [];
  currentPage = 1;

  const resultsDiv = document.getElementById("results");
  const countDiv = document.getElementById("count"); 
  const paginationDiv = document.getElementById("pagination");

  resultsDiv.innerHTML = "";
  countDiv.innerHTML = "";
  paginationDiv.innerHTML = "";

  if (!query) return;

    matches = allData.filter(item =>
    item.content.toLowerCase().includes(query.toLowerCase())
  );

    countDiv.textContent = `検索結果 ${matches.length} 件`;

  if (matches.length === 0) {
    resultsDiv.textContent = "該当なし";
    return;
  }

  renderPage();
}

  function renderPage() {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    const start = (currentPage - 1) * pageSize;
    const end = start + pageSize;
    const pageItems = matches.slice(start, end);

    for (let m of pageItems) {
      const div = document.createElement("div");
      div.className = "result";
      div.textContent = m.content;  
      resultsDiv.appendChild(div);
    }

    renderPagination();
  }

  function renderPagination() {
    const paginationDiv = document.getElementById("pagination");
    paginationDiv.innerHTML = "";

    const totalPages = Math.ceil(matches.length / pageSize);

    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.disabled = (i === currentPage);
      btn.onclick = () => {
        currentPage = i;
        renderPage();
      };
      paginationDiv.appendChild(btn);
    }
  }
  loadData();
</script>
</body>
</html>




