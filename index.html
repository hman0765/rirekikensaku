<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>テスト検索</title>
  <link href="favicon.ico" rel="icon">
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #results { margin-top: 20px; }
    .result { padding: 5px; border-bottom: 1px solid #ccc; }
    .file { color: #888; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>過去の履歴一括検索</h1>
  <p>テスト運営中</p>
  <input type="text" id="query" placeholder="検索語を入力">
  <button onclick="search()">検索</button>
  <div id="count"></div>
  <div id="pagination-top"></div>
  <div id="results"></div>
  <div id="pagination-bottom"></div>

 <script>
  const jsonFiles = [
"data/201012.json",
"data/201102.json",
"data/201104.json",
"data/201108.json",
"data/201109.json",
"data/201112.json",
"data/201204.json",
"data/201208.json",
"data/201212.json",
"data/201304.json",
"data/201308.json",
"data/201312.json",
"data/201404.json",
"data/201408.json",
"data/201412.json",
"data/201504.json",
"data/201508.json",
"data/201512.json",
"data/201604.json",
"data/201608.json",
"data/201612.json",
"data/201704.json",
"data/201708.json",
"data/201712.json",
"data/201804.json",
"data/201808.json",
"data/201812.json",
"data/201904.json",
"data/201908.json",
"data/201912.json",
"data/202004.json",
"data/202008.json",
"data/202012.json",
"data/202101.json",
"data/202104.json",
"data/202108.json",
"data/202112.json",
"data/202204.json",
"data/202208.json",
"data/202209.json",
"data/202212.json",
"data/202304.json",
"data/202308.json",
"data/202312.json",
"data/202404.json",
"data/202408.json",
"data/202412.json",
"data/202501.json",
"data/202504.json",
"data/202508.json",
  ]; // JSONファイル
  let allData = [];
  let matches = [];
  let currentPage = 1;
  const pageSize = 100;

  async function loadData() {
    for (let file of jsonFiles) {
      try {
        const res = await fetch(file);
        const data = await res.json();
        allData = allData.concat(data);
      } catch (e) {
        console.error("読み込み失敗:", file, e);
      }
    }
  }

  async function search() {
  const query = document.getElementById("query").value.trim();
  matches = [];
  currentPage = 1;

  const resultsDiv = document.getElementById("results");
  const countDiv = document.getElementById("count");      // 件数表示用 div
  const paginationDiv = document.getElementById("pagination");

  // 初期化
  resultsDiv.innerHTML = "";
  countDiv.innerHTML = "";
  paginationDiv.innerHTML = "";

  if (!query) return;

  // 大文字小文字無視で検索
  matches = allData.filter(item =>
    item.content.toLowerCase().includes(query.toLowerCase())
  );

  // 件数表示
  countDiv.textContent = `検索結果 ${matches.length} 件`;

  if (matches.length === 0) {
    resultsDiv.textContent = "検索結果0件です";
    return;
  }

  renderPage();
}

  function renderPage() {
    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    const start = (currentPage - 1) * pageSize;
    const end = start + pageSize;
    const pageItems = matches.slice(start, end);

    for (let m of pageItems) {
      const div = document.createElement("div");
      div.className = "result";
      div.textContent = m.content;  // 行内容だけ
      resultsDiv.appendChild(div);
    }

    renderPagination();
  }

  function renderPagination() {
  const topDiv = document.getElementById("pagination-top");
  const bottomDiv = document.getElementById("pagination-bottom");

  if (!topDiv || !bottomDiv) {
    console.error("pagination-top / pagination-bottom がHTMLに存在しません");
    return;
  }

  topDiv.innerHTML = "";
  bottomDiv.innerHTML = "";

  const totalPages = Math.ceil(matches.length / pageSize);

  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.disabled = (i === currentPage);
    btn.onclick = () => {
      currentPage = i;
      renderPage();
    };
    topDiv.appendChild(btn.cloneNode(true)); // 上その2
    bottomDiv.appendChild(btn);              // 下
  }
}
  loadData();
</script>


<a href="note01.html">お知らせ</a>

 
</body>
</html>
































